<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Graphe de Connaissances Unifié - spaCy</title>
    <link rel="icon" href="https://spacy.io/favicon.ico" type="image/png">
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style type="text/css">
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: #f4f7f9;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        h1, h2 {
            color: #0d3a5f;
            text-align: center;
        }
        p {
            text-align: center;
            color: #555;
        }
        #graph-container {
            display: flex;
            flex-direction: row;
            border: 1px solid #ccc;
            border-radius: 8px;
            background-color: #fff;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            height: 85vh;
        }
        #mynetwork {
            width: 70%;
            border-right: 1px solid #ccc;
            height: 100%;
        }
        #info-panel {
            width: 30%;
            padding: 20px;
            overflow-y: auto;
            box-sizing: border-box;
        }
        #info-panel h3 {
            margin-top: 0;
            color: #005a9c;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }
        #info-panel p {
            text-align: left;
            font-size: 14px;
            line-height: 1.6;
        }
        #info-panel ul {
            list-style-type: none;
            padding: 0;
        }
        #info-panel li {
            background-color: #eef5ff;
            margin-bottom: 8px;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 13px;
            word-wrap: break-word;
        }
        #info-panel .cat-data { border-left: 4px solid #fa8072; }
        #info-panel .cat-core { border-left: 4px solid #1e90ff; }
        #info-panel .cat-annotation { border-left: 4px solid #e85d04; }
        #info-panel .cat-training { border-left: 4px solid #5a189a; }
        #info-panel .cat-tools { border-left: 4px solid #2b9348; }

        footer {
            text-align: center;
            padding: 20px;
            margin-top: 20px;
            color: #777;
            font-size: 12px;
            border-top: 1px solid #eee;
        }
        .docs-link { text-align: center; margin: -10px 0 20px 0; }
        .docs-link a { color: #005a9c; text-decoration: none; font-weight: 500; }
        .docs-link a:hover { text-decoration: underline; }
    </style>
</head>
<body>

    <h1>Graphe de Connaissances Unifié de la Bibliothèque spaCy</h1>
    <p>Cliquez sur un nœud pour explorer les concepts, des données brutes à l'entraînement du modèle.</p>

    <p class="docs-link">Pour plus de détails, consultez la <a href="https://spacy.io/usage/spacy-101" target="_blank" rel="noopener noreferrer">documentation officielle de spaCy</a>.</p>

    <div id="graph-container">
        <div id="mynetwork"></div>
        <div id="info-panel">
            <h3>Détails du Concept</h3>
            <p>Sélectionnez un élément dans le graphe pour afficher sa description et les opérations associées ici.</p>
        </div>
    </div>

    <script type="text/javascript">
        const nodeDetails = {
            corpus: {
                title: "Corpus de Données",
                description: "Un ensemble de textes qui sert de source pour l'analyse et l'entraînement. C'est le point de départ de tout projet NLP.",
                endpoints: [ { category: "Data", path: "Source de la vérité terrain (ground truth)" } ]
            },
            texte: {
                title: "Texte Brut (chaîne)",
                description: "Le contenu textuel d'un fichier, lu en tant que simple chaîne de caractères. C'est l'entrée brute pour le modèle de langue.",
                endpoints: [ { category: "Data", path: "open(file).read()" } ]
            },
            nlp: {
                title: "Modèle de Langage (nlp)",
                description: "L'objet central de spaCy contenant le pipeline de traitement. Il transforme le texte brut en un objet Doc riche en annotations. Un modèle peut être pré-entraîné ou personnalisé.",
                endpoints: [
                    { category: "Core", path: "spacy.load('fr_core_news_sm')" },
                    { category: "Core", path: "doc = nlp('texte...')" },
                    { category: "Core", path: "nlp.pipe_names" }
                ]
            },
            doc: {
                title: "Objet Doc",
                description: "Un conteneur pour le texte traité. Il contient les tokens, les spans, les entités et toutes les annotations. C'est l'objet principal que vous manipulez.",
                endpoints: [
                    { category: "Core", path: "doc.ents (entités)" },
                    { category: "Core", path: "doc.sents (phrases)" },
                    { category: "Core", path: "Itération : for token in doc:" }
                ]
            },
            token: {
                title: "Token",
                description: "L'unité de base du texte (mot, ponctuation). Chaque token possède de nombreuses annotations linguistiques.",
                endpoints: [
                    { category: "Annotation", path: ".text, .lemma_, .pos_, .dep_" },
                    { category: "Annotation", path: ".is_stop, .is_alpha" }
                ]
            },
            span: {
                title: "Span",
                description: "Une tranche d'un Doc composée d'un ou plusieurs tokens. Les entités nommées sont le type de Span le plus courant.",
                endpoints: [
                    { category: "Annotation", path: ".text, .label_" },
                    { category: "Annotation", path: ".start, .end (indices)" }
                ]
            },
            entite: {
                title: "Entité Nommée (NER)",
                description: "Un Span avec une étiquette (ex: 'PER', 'LOC'). C'est le résultat d'un composant de Reconnaissance d'Entités Nommées.",
                endpoints: [
                    { category: "Annotation", path: "doc.ents" },
                    { category: "Annotation", path: "ent.text, ent.label_" }
                ]
            },
            visualisation: {
                title: "Visualisation (displaCy)",
                description: "L'outil de spaCy pour afficher graphiquement les entités ou les dépendances syntaxiques d'un Doc.",
                endpoints: [ { category: "Tools", path: "displacy.render(doc, style='ent')" } ]
            },
            matcher: {
                title: "Matcher",
                description: "Permet de trouver des séquences de tokens basées sur des règles, comme des expressions régulières pour les annotations linguistiques.",
                endpoints: [
                    { category: "Tools", path: "Matcher(nlp.vocab)" },
                    { category: "Tools", path: "matcher.add('PATTERN', [rules])" }
                ]
            },
            export: {
                title: "Export des Données",
                description: "Sauvegarde les informations extraites (comme les entités) dans un format structuré (JSON, CSV) pour une utilisation future.",
                endpoints: [ { category: "Tools", path: "json.dump(data, file)" } ]
            },
            entrainement: {
                title: "Entraînement de Modèle",
                description: "Processus de mise à jour des poids d'un modèle (comme le composant NER) à partir d'exemples annotés provenant du Corpus.",
                endpoints: [
                    { category: "Training", path: "python -m spacy train ..." },
                    { category: "Training", path: "Nécessite un jeu d'entraînement et de validation" }
                ]
            },
            config: {
                title: "Fichier de Configuration",
                description: "Un fichier (.cfg) qui définit tous les paramètres pour l'entraînement : architecture, hyperparamètres, données, etc.",
                endpoints: [ { category: "Training", path: "spacy init fill-config" } ]
            },
            evaluation: {
                title: "Évaluation de Performance",
                description: "Mesure la qualité d'un modèle en comparant ses prédictions aux annotations de référence (vérité terrain).",
                endpoints: [ { category: "Training", path: "Calcul de Précision, Rappel, F-score" } ]
            },
            scorer: {
                title: "Objet Scorer",
                description: "Un objet spaCy qui calcule les métriques de performance en comparant les entités prédites et de référence.",
                endpoints: [ { category: "Training", path: "scorer.score_spans(...)" } ]
            }
        };

        const nodes = new vis.DataSet([
            // Flux de données
            { id: "corpus", label: "Corpus", group: 0, mass: 3 },
            { id: "texte", label: "Texte Brut", group: 0, mass: 2 },
            
            // Coeur spaCy
            { id: "nlp", label: "Modèle (nlp)", group: 1, mass: 5 },
            { id: "doc", label: "Objet Doc", group: 1, mass: 4 },

            // Annotations
            { id: "token", label: "Token", group: 2, mass: 1 },
            { id: "span", label: "Span", group: 2, mass: 1 },
            { id: "entite", label: "Entité Nommée", group: 2, mass: 2 },

            // Entraînement & Évaluation
            { id: "entrainement", label: "Entraînement", group: 3, mass: 4 },
            { id: "config", label: "Config (.cfg)", group: 3, mass: 2 },
            { id: "evaluation", label: "Évaluation", group: 3, mass: 3 },
            { id: "scorer", label: "Scorer", group: 3, mass: 1 },

            // Outils & Sorties
            { id: "matcher", label: "Matcher", group: 4, mass: 2 },
            { id: "visualisation", label: "Visualisation", group: 4, mass: 1 },
            { id: "export", label: "Export (JSON)", group: 4, mass: 1 },
        ]);

        const edges = new vis.DataSet([
            // Du corpus au doc
            { from: "corpus", to: "texte", label: "est lu comme" },
            { from: "texte", to: "nlp", label: "est traité par" },
            { from: "nlp", to: "doc", label: "produit un" },
            
            // Contenu du doc
            { from: "doc", to: "token", label: "contient des" },
            { from: "doc", to: "span", label: "contient des" },
            { from: "span", to: "entite", label: "peut être une" },
            { from: "doc", to: "entite", label: "expose les" },
            
            // Utilisation du doc et des entités
            { from: "doc", to: "visualisation", label: "est visualisé via" },
            { from: "doc", to: "matcher", label: "est analysé par le" },
            { from: "entite", to: "export", label: "sont exportées" },
            
            // Boucle d'entraînement
            { from: "corpus", to: "entrainement", label: "alimente l'" },
            { from: "config", to: "entrainement", label: "configure l'" },
            { from: "entrainement", to: "nlp", label: "produit/affine un", dashes: true },
            
            // Boucle d'évaluation
            { from: "nlp", to: "evaluation", label: "est évalué" },
            { from: "corpus", to: "evaluation", label: "fournit la réf.", dashes: true },
            { from: "evaluation", to: "scorer", label: "utilise un" },
        ]);

        const container = document.getElementById('mynetwork');
        const data = { nodes: nodes, edges: edges };
        const options = {
            nodes: {
                shape: 'dot', size: 20,
                font: { size: 14, color: '#333' },
                borderWidth: 2,
            },
            edges: {
                width: 1,
                font: { size: 10, align: 'middle' },
                arrows: { to: { enabled: true, scaleFactor: 0.5 } },
                color: { color: '#848484', highlight: '#005a9c' }
            },
            groups: {
                0: { color: { background: '#ffa07a', border: '#fa8072' } }, // Data Flow
                1: { color: { background: '#61affe', border: '#1e90ff' }, font: { color: 'white' } }, // Core spaCy
                2: { color: { background: '#fca130', border: '#e85d04' } }, // Annotations
                3: { color: { background: '#9d4edd', border: '#5a189a' }, font: { color: 'white' } }, // Training
                4: { color: { background: '#49cc90', border: '#2b9348' } }, // Tools & Outputs
            },
            physics: {
                barnesHut: {
                    gravitationalConstant: -5000,
                    centralGravity: 0.15,
                    springLength: 180,
                },
            },
            interaction: { hover: true },
        };
        const network = new vis.Network(container, data, options);

        network.on("click", function (params) {
            const infoPanel = document.getElementById('info-panel');
            if (params.nodes.length > 0) {
                const nodeId = params.nodes[0];
                const details = nodeDetails[nodeId];
                if (details) {
                    let endpointsHtml = '<ul>';
                    details.endpoints.forEach(ep => {
                        const catClass = `cat-${ep.category.toLowerCase()}`;
                        endpointsHtml += `<li class="${catClass}"><strong>${ep.category}</strong>: ${ep.path}</li>`;
                    });
                    endpointsHtml += '</ul>';

                    infoPanel.innerHTML = `
                        <h3>${details.title}</h3>
                        <p>${details.description}</p>
                        <h4>Exemples & Attributs Clés :</h4>
                        ${endpointsHtml}
                    `;
                }
            } else {
                 infoPanel.innerHTML = `
                    <h3>Détails du Concept</h3>
                    <p>Sélectionnez un élément dans le graphe pour afficher sa description et les opérations associées ici.</p>
                `;
            }
        });
    </script>

    <footer>
        <p>&copy; 2025 Graphe Unifié par IA | Inspiré par les tutoriels spaCy</p>
    </footer>

</body>
</html>